---
title: "Hypothesis testing tutorial: Are toads right-handed?"
output: learnr::tutorial
runtime: shiny_prerendered
---

```{r setup, include=FALSE}
library(learnr)
knitr::opts_chunk$set(echo = FALSE)
library(here)
library(kableExtra)

load(here::here("./inst/tutorials/toads_spreadsheet/toads_char.RData"))

# footnotes to appear at bottom of main windw
footnotes <- c(
"Notes: notes on each row", 
"n: sample size; the total number of toads, coin flips etc",
"X.R.hand: Right-handed; the number of right-handers observed in a sample.  This study observed 14 righties.",
"prop.x: proportion X; the number of right-handed toads (X) out of all of them (n)",
"prob.x: probability X: is the probability that, if our null is correct, how likely are we to end up with a sample of 14 right handers out of 18 due to chance.")

# bootstrap options for tables (?)
my.boot.opt <- c("striped", 
                 "hover", 
                 #"condensed",
                 "responsive")
```

## To Do

* worksheet
* plots (barplots)
* why answers to quizes showing up?

## Preface

This tutorial is based on Chapter 6: Hypothesis testing from Whitlock & Schluter's [*Analysis of Biological Data*.](http://whitlockschluter.zoology.ubc.ca/).

In section 6.2: "Hypothesis testing: an example" (pg 153, 2nd ed), Whitlock & Schluter present data from a paper by Bisazza et al (1996) titled ["Right-pawedness in toads"](https://www.nature.com/articles/379408a0), published in Nature.


### References

Bisazza, A,C Cantalupo, A Robins, LJ Rogers and G Vallortigara.  1996.  [Right-pawedness in toads.  Nature 379: 408.](https://www.nature.com/articles/379408a0)

Fitch & Braccini 2013.  [Primate laterality and the biology and evolution of human
handedness: a review and synthesis.  Annal of the New York Academy of Sciences.](https://nyaspubs.onlinelibrary.wiley.com/doi/abs/10.1111/nyas.12071)

![](https://commons.wikimedia.org/wiki/File:Common_toad_(Bufo_bufo)_Kampinos.jpg#/media/File:Common_toad_(Bufo_bufo)_Kampinos.jpg)


## Introduction 

Humans populations are typically about 90% right-handed (Fitch & Braccini 2013).  Do other species preferentially complete tasks with one hand (or paw)?  As part of their study, Bisazza et al (1996) assayed 18 wild-caught [common toads (*Bufo bufo*)](https://en.wikipedia.org/wiki/Common_toad) in the lab to determine whether they completed a task preferentially with their right or left paws.

In this study, 14 of the 18 toads completed the task with their right paw, and 4 completed it with their left.  Is this evidence that toads in this population are like humans predominantly use one paw over the other?

In this tutorial we will walk through Whitlock & Schluter's assessment of this question and carry out a **hypothesis test**.  We will carry out all the calcualtions needed to reproduce their Table 6.2-1 (page 156) and the other calculations in the text (pages 153-159).

In particular, we will walk through the process of carrying out a **hypothesis test** using what statisticians call **binomial data** by calculating a **p-value** and comparing it against a **sampling distribution.**

It should be noted that the specific hypothesis being tested is not whether frogs are right-handed or left-handed; rather, whether there is an over tedency in the population, which could be right handed or left handed.  This is somewhat awkward, but the reason things are framed this way should gradually become apparent.

## Hypothesis testing with binomial data

When you [flip a coin](https://en.wikipedia.org/wiki/Coin_flipping) you get one of two possible results: "heads" (usually the face of a famous person) or "tails."  Statisticians call the process of flipping the coin a **trial** (in particular a Bernouli trial).  If you do several coin flips you have generate data which can give you information on how likely you are to get heads or tails.  This is called **binomial data**.  The number of heads you get is the number of **events** or **successes**.

The toad data from Bisazza et al (1996) is also **binomial data**.  It consists of 18 **trials** where there are two possible results: left paw or right paw.

Binomial data is very common in biology: is an organism alive or dead?  Was a flower eaten or not eaten?  Is a fruit fly male or female?  Binomial data is also very useful for demonstrating core concepts of hypothesis testing because the math is fairly easy.

![](https://commons.wikimedia.org/wiki/File:Coin_Toss_(3635981474).jpg#/media/File:Coin_Toss_(3635981474).jpg)


## Carrying out calcualtions in a spreadsheet 

The goal of this tutorial is to walk you step by step through the calcualtions done by Whitlock & Schluter and to provide opportunities to interact directly with the data.  Ideally, while working through this tutorial you will carry out the calculatiosn as you go either on the provided worksheet or in a spreadsheet.  A spreadsheet like table will be displayed showing you the calculations as they are done.  You can also do calculations using basic R code within the tutorial if you want.

There will also be prompts to answer questions on the calculatiosn and concepts as you go.  

![](https://commons.wikimedia.org/wiki/File:OpenOffice.org_Calc.png#/media/File:OpenOffice.org_Calc.png)

## Key Concepts in hypothesis testing

* Hypothesis 
* Null hypothesis (Ho)
* Alternative hypothesis (Ha)
* Sampling distribution
* test statistic
* binomial data
* critical value (alpha)


## Summary of the toad-handedness data

The table below summarizes the data we will be using and the abbreviations that will be used in subsequent tables.  The letter **X** is often used to indicate the number of focal **events** or **successes**, so I call the number of right-pawed (or handed)  toads **X.right.handed**.  The letter **n** indicates sample size which here is the total number of **trials**; that is, the total number of toads in the study.  I'll call this **n.total** for emphasis.

In the subsequent steps of this tutorial we'll reformat these numbers into a special structure that will represent what is known as a **sampling distribution**.  This will allow us to calcualte the **p-value**, which will allow us to assess the hypothesis of whether frogs preferentially use one paw or not.

```{r echo = F}
x <- sheets.list[[1]][c(1:4),c(1:3)]
x %>%
  knitr::kable(caption = "Raw toad handedness data") %>%
  kableExtra::kable_styling(bootstrap_options = my.boot.opt,
                position = "left")
```

## Data exploration worksheet

In a spreadsheet set up a table that looks like this, or use the provided blank handout.  An example of spreadsheet can be downloaded as a .csv file from [here]().  The structure will be apparent as we work through things.  We will build up this table to explore the implications of the null hypothesis that toad are no more likely to be right handed than left handed.  "n" is the starting number of toads (the sample size). "X.R.hand" is an abbreviation of "right-handed" and is the number of right-handers observed in this sample.

"proportion.X" is the proportion of toads that are right handed.  This is calculated as the (number observed R-handed)/(total observed)


```{r echo= F}
sheets.list[[2]] %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) %>%
  footnote(alphabet = footnotes)
```

```{r q1}
question("Estimate the approximate value of proportion.X",
    answer("0.25"),
    answer("0.5"),
    answer("0.75", correct = TRUE),
    answer("0.99")
  )
```



## Probability of a specific number of right-handed toads

"prob.X" is the probability that, if our null (Ho) is correct, we will end up with a sample of 14 right handers out of 18 just due to chance.

That is, if the population overall has a 50:50 ratio of right:left handed toads, how likely are we to get a biased sample of 14 right handers and only 4 left handers.

```{r echo= F}
sheets.list[[3]] %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) %>%
  footnote(alphabet = footnotes)
```

```{r q2}
quiz(
question("What do you think is the probability of getting, 
         say, 14 heads if you flip a coin 18 times?",
    answer("almost 1 (you will definitely get it)"),
    answer("1 in 10 (probablity of 0.1)"),
    answer("1 in 100", correct = TRUE),
    answer("1 in 1000"),
    answer("1 in 10000")
  ),

question("If **100 people** in your class all flipped 18 coins *each*, what is the probability that at least one persion will get 14 heads?",
    answer("almost 1 (someone will probably get lucky and get 14 heads)", correct = TRUE),
    answer("1 in 10 (probablity of 0.1)"),
    answer("1 in 100"),
    answer("1 in 1000"),
    answer("1 in 10000")
  )

)
```




## Probability of a specific number of right-handed toads

To calculate this probability we need the binomial distribution		

The binomial distribution for a given scenario is calcualted in Excel using the BINOM.DIST() command		

The arguments of the =BINOM.DIST() function are		
* number_s: the number of "successes" (hence "_s") or "events"; what we are calling "X"
* trials:	trials; the number of opportunities for a "success" to occur; here 18 toads
* probability_s:	the null hypothesis about the probablity of the successu occuring; here, 0.5 (=50:50 or 50%)
* cumulative	this is set to "FALSE" so we get the estimated probability of the specific event and only that event otherwise we are calcuatling a value related to our event of interest (14 right handers) plus some other thigns.

```{r echo= F}
sheets.list[[4]][,-c(7:8)] %>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) %>%
  footnote(alphabet = footnotes)
```









## Probability of a specific number of right-handed toads

The probability of 14 toads being right handed in the null hypothesis was true is 0.012
Note that this is the probability of getting exactly 14 toads.

So, we can say that if toads are not more likely to be right handed than left handed (because why would they?), we would expect that the probability of getting  a sample of exactly 14 right-handed toads (0.78 right handed, or 78%, the value in the "proportion.X" columne) is 0.012.  So pretty unlikely.  Another way of say this is that if we got that many, we would be surprised (again, assuming that the real probability is indeed 0.5).

A proportion of 0.012 is equivalent to about 1/100 (1/112 to be more precise).

To use the coin flipping example, you would have about a 1 in 100 chance of getting exactly 14 heads.  But, if 100 people did this, then there's  a pretty good chance one of them will get it; that is 1/100*100 = 1

```{r echo= F}
sheets.list[[5]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) %>%
  footnote(alphabet = footnotes)
```




## Fill out data table

* Let's fill out the table some more.  
* n is always 18 because we are only considering an study where 18 toads were examined.


```{r echo= F}
sheets.list[[6]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive"))
```




## Fill out data table some more

* The goal of this table is to think about all the possible ways the study could've panned out and all the possible alternative sets of results we could've gotten.
* That is, if you sample 18 toads, what are the other possible number of right-handed toad 
 you could've observed?
* This is just simply all the other possible number of right handed toads: 0 right handers
 or 1 right hander, or 2, or 3, or . 18.


```{r echo= F}
sheets.list[[7]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```






## What is our null hypothesis (Ho)?

Now let's directly consider the **null hypothesis (Ho)**:

Consider which row of the datatable matches up to our null hypothesis.  Again, only one row matches our real data (14 right handers) and the rest of the rows are to help us think about other ways the experiment could've panned out.



```{r echo= F}
sheets.list[[8]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive"))
```


```{r q4}
question("toads are no more likely to be right handed than left handed so you'd expect that if you collected 18 toads.How many would be right handed?",
    answer("3"),
    answer("6"),
    answer("9", correct = TRUE),
    answer("12"),
    answer("16")
  )
```



## What is the probability of exactly 9 right-handed toads (if the null is true)?

If toad are no more likely to be right handed than left handed, you'd expect that if you collected 18 toads, 9 would be right handed, and 9 would be left handed.  So 0.5 or 50% would be righties.

Even if the null is true, how likely is it to get exactly 9?


```{r echo= F}
sheets.list[[9]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```



```{r q5}
question("What is the **probability** that you would get **exactly 9** right handers in the study?",
    answer("1 in 100"),
    answer("1 in 10"),
    answer("2 in 10 (= 1 in 5)",correct = TRUE),
    answer("5 in 10")
  )
```

## What is the probability of exactly 9 right-handed toads (if the null is true)?

The answer might be a bit surprising: 0.19.  Why isn't it 0.5?

Remember, we are considering the probability of getting **exactly** 9 right-handed toads. (AND we are thinking about a world where the true probalbity of toads being righted handed is indeed 0.5)

```{r echo= F}
sheets.list[[10]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```






## What is the probability of exactly 9 right-handed toads (if the null is true)?

* Its not 0.5 because we are asking "What are the chances of getting **exactly 9** toads which are right handed, no more no less." 
* This is like asking "What are the chance of flipping a coin 18 times and getting exactly 9 heads."
* A fair coin has a 50:50 chance of being heads, but chances are if you flip one 18 times you won't get exactly 9 heads.
* You will probably get close to 9; maybe 9 exactly, but also maybe a few more (10 or 11), or a few less (7 or 8).
* So, overall, its very likely that you'll get close to 9 heads, but exactly 9 is kind of hard.


```{r echo= F}
sheets.list[[11]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```








## What is the probability of getting about 9 toads (if the null is true)?

* We can test this but calcualting the probabilities of these different options and adding them up
* THe calcualtiosn in this spreadsheet shot that indeed, if your coin is fair or toads are 50:50 R:L then the probability of getting 8, 9 or 10 heads is 0.52
* Moreover, the probability of getting between 7 and 11 is really high: 0.76

```{r echo= F}
sheets.list[[12]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```







## What is the probablity of an extreme event?

* What about something extreme, like flipping a coin 18 times and getting all heads
* or, for this study, sampling 18 toads and all of them are right handed even
though in the population they are from the ratio of righties to lefties is 50:50?

```{r echo= F}
sheets.list[[13]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```


```{r q14}
question("What is the probability of all 18 toads being right handed if the null is true?",
    answer("0.0"),
    answer("1 in 1,000,000", correct = TRUE),
    answer("1 in 10,000"),
    answer("1 in 1000")
  )
```







## What is the probablity of an extreme event?


As you might expect, the probability of this happening is really really small:

* A spreadsheet will usually state this in scientific notation: 3.81E-06
* which means 3.81*10^-6
* or 0.00000381


```{r echo= F}
sheets.list[[14]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```








## What is the probablity of an extreme event?


What about 17 right handers and only 1 leftie? This is just a touch more likley
6.87E-05 or 6.87 * 10^-5 or 0.0000687

```{r echo= F}
sheets.list[[15]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```








## What is the probablity of an extreme event?

How about the opposite scenario: flipping a coin 18 and getting no heads?
(or, for us, sampling 18 toads and getting none that are right handed when
the source population is 50:50)


```{r echo= F}
sheets.list[[16]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```










## What is the probablity of an extreme event?

* The probability is 3.81E-06, the same as for 18 head and no tails.   
* This is because the converse of getting 18 heads and no tails is getting 18 tails and no heads.
* Or, for this study, the converse of getting 18 right handers and no lefties is getting 18 lefties and no righties


```{r echo= F}
sheets.list[[17]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```






## Filling out some more parts of the table


For the sake of completeness we'll fill in a few more situations.  First, getting just one right hander and no 17 lefties is the converse of getting 18 right handers and just 1 leftie.
 
```{r echo= F}
sheets.list[[18]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```







## What is the opposite of 14 right-handed toads?

One last preliminary number.  We observed 14 right handers and only 4 lefties.
Something to consider is what if we got the converse of this: only 4 righties and 14 lefties?  Both possiblities have the same probability.  

Moving forward, it will be important to consider both what we happened to observed and the 
converse or mirror image event.

Say somone bets you "I can flip a coin and get 14 heads.  You think they are a sucker so you say yes.
They take out a coin, flip it in the air, catch it in their palm, then flip it over on to the back of their hand.
They keep getting heads - 14 times!
You suspect the coin is rigged.
Now, what if they had said "I can flip a coin and only 4 tails."  This is the converse

(is this makign sense)


```{r echo= F}
sheets.list[[19]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```








## Moving forward: tail probabilities

* what is more likely, to get 14 geads, or at least 14 heads; that is 14 or 15 or 16 or 17 or 18.
* If I am concerned that a coin is not fair I am probably not concerned that it produces
an exact number of heads for a given number of flips 
* That wouldn't be a rigged coin, but straight up magic!
* what I'd be concerned with is that it produces an unual number of heads
so I won't be interested in exactly 14, but 14 or more
* So, moving forward, let's consider what the probablity of getting more than 14 right-handed toes
* We've already done some of this so we'll fill in 15 righties and 16 righties
* Something to consider is "What is the probability of getting 14 OR MORE right handed toad, if in reality the source population is 50:50 R:L"

When we add up probabilites like these we are calculating "tail probabilities."  We'll explain why later.
 
 
```{r echo= F}
sheets.list[[20]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```


```{r q20}
question("What is the probability of getting 14 or more right handed toads if the null is true?.  Eyeball the answer",
answer("0.001"),
answer("0.01"),
answer("0.015",correct = TRUE),
answer("0.1"))
```



## Moving forward: tail probabilities

The answer is 0.015, or on the order of magnitude of 1 in 100 (1 in 105 to be exact).


```{r echo= F}
sheets.list[[21]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```






## Moving forward: tail probabilities

Getting lots of heads is the converse of getting lots of tails and depends on your coin flipping protocol.  So getting 14 or more tails is just as unusual as 14 or more tails.  
or, equivalently, 4 or fewer heads.  (Again, this is all assuming the null is true - tired of me saying that yet?)


```{r echo= F}
sheets.list[[22]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```






## Moving forward: tail probabilities

We can add up all of these numbers and see that they are the same as for 14 or more right-handed toads.

```{r echo= F}
sheets.list[[23]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```








## Fill in the rest of the probabilities

* We can fill in the rest of the probabilties.  
* We now have created a table that outlines all possible outcomes of the experiment.

```{r echo= F}
sheets.list[[24]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive"))
```


```{r q24}
question("What does the prob.X column sum to?",
         answer("0.5"),
         answer("1",correct = TRUE),
         answer("2",message = "We're working with probabilities so they always add up too..."),
         answer("100",message = "This would be true if we were working iwth %s"))
```




## Add up each tail


```{r echo= F}
sheets.list[[25]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```






## Total of all tails

```{r echo= F}
sheets.list[[26]]%>%
  kable() %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed","responsive")) 
```


